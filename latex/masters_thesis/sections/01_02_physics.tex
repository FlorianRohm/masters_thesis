% !TEX root = ../thesis.tex
After describing the general structure of the LBM, this section will cover another important question of \gls{cfd}:\@ What do we want to know at the end?

The most basic thing one is interested in, is information about the flow field, i.e.\@ density, velocity and temperature in the domain, to analyze the flow patterns.
Those are called macroscopic values.

When calculating with the Navier-Stokes equations, getting those values is easy, as the equations are stated in exactly those variables.
Unfortunately, the Boltzmann equation and also the discretized equation~\eqref{eq: lattice boltzmann equation} calculate the microscopic particle distributions.
\glsadd{micVar}\glsadd{macVar}
The extraction of macroscopic values out of those distributions will be treated in this section.

Before introducing (macroscopic) velocity and density, we have to take a small detour to the field of probability theory and introduce moments.
In analogy to bivariat probability distributions, we define the characteristic variables $m_{\alpha\beta}$, called moments, of a \gls{pdf} $f$ as
\begin{equation}
  \label{eq: moments continuous}
  m_{\alpha\beta}(\vec{x},t) \defined  \int v_x^\alpha v_y^\beta f(\vec{v},\vec{x},t) d\vec{v},\quad\forall\alpha,\beta\in\N,
\end{equation}
Where $v_x$ and $v_y$ are the components of the particle velocity $\vec{v}$.
In contrary to probability distributions, the zeroth moment $m_{00}$ is not one. The first moments $m_{10}$ and $m_{01}$ are still its mean values in the corresponding directions.

Additionally, the \glspl{pdf} and hence all derived characteristic variables will depend on space and time in the rest of this thesis. For the sake of simplicity this dependence is going to be omitted every time when not strictly required and implicitly assumed. Hence
\begin{equation}
  \label{eq: leave out x and y}
  m_{\alpha\beta} \defined m_{\alpha\beta}(\vec{x},t).
\end{equation}
This is also true for all other values like density and velocity.

Another set of characteristic variables are the centralized moments $c_{\alpha\beta}$ defined as
\begin{equation}
  \label{eq: central moments continuous}
  c_{\alpha\beta} \defined \int {\left(v_x - \frac{m_{10}}{m_{00}}\right)}^\alpha {\left(v_y-\frac{m_{01}}{m_{00}}\right)}^\beta f(\vec{v})  d\vec{v}.
\end{equation}

Here, the assumption associated with~\eqref{eq: leave out x and y} of course also holds, making the centralized moments dependent on space and time.

As deduced in~\cite[pages 23 ff.]{harris2004introduction}, we can calculate the macroscopic density $\rho$, the macroscopic velocity $\vec{u}=\begin{pmatrix}u_x\\u_y\end{pmatrix}$ and the pressure tensor $\tensor{P}=\begin{pmatrix}\tensor{P}_{xx}&\tensor{P}_{xy}\\ \tensor{P}_{yx}&\tensor{P}_{yy}\end{pmatrix}$ as

\begin{equation}
  \label{eq: physical quantities}
  \begin{aligned}
    \rho & = \int f(\vec{v}) d\vec{v} = m_{00} \\
    u_x
    & = \frac{1}{\rho}\int v_x f(\vec{v}) d\vec{v} = \frac{ m_{10} }{ m_{00} }\\
    u_y
    & = \frac{1}{\rho}\int v_y f(\vec{v}) d\vec{v} = \frac{ m_{01} }{ m_{00} }.\\
    \tensor{P}_{xy}=\tensor{P}_{yx}
    & = \int (v_x - u_x)(v_y - u_y) f(\vec{v}) d\vec{v}
      = c_{11} \\
    \tensor{P}_{xx}
    & = \int {(v_x - u_x)}^2 f(\vec{v}) d\vec{v}
      = c_{20} \\
    \tensor{P}_{yy}
    & = \int {(v_y - u_y)}^2 f(\vec{v}) d\vec{v}
      = c_{02},
  \end{aligned}
\end{equation}
where we identified the definitions of the moments and central moments in the second equation in each line.
Those connections do hold for the equilibrium case, which is locally attained nearly instantaneously for the continuous case, c.f.~\cite[page 218]{smits2000physical}.
From the equations in~\eqref{eq: physical quantities}, we can also conclude, that centralized moments are just like normal moments, but seen from a frame of reference moving with the flow velocity $\vec{u}$.
\glsadd{frame of reference}

Switching to the discrete case, we can no longer assume local equilibrium.
In fact, we already assume to be in a non equilibrium state, as we want the collision to shift our particle distributions a bit towards the local equilibrium.
Looking at the quantities defined in~\eqref{eq: physical quantities}, we can directly define the velocity and density, as those should not be altered by the collision due to mass and momentum conservation laws.
Also, the integrals in~\eqref{eq: moments continuous} and~\eqref{eq: central moments continuous} will degenerate to sums when changing to the discrete velocity set~\eqref{eq: definition of the velocities}, leaving us with
\begin{align}
  m_{\alpha\beta} &= c^{\alpha + \beta}\sum_{i,j \in \{-1,0,1\}} i^\alpha j^\beta f_{ij}
  \label{eq: moment definition}\\
  c_{\alpha\beta} &= \sum_{i,j \in \{-1,0,1\}}
  {\left(ci - \frac{m_{10}}{m_{00}}\right)}^\alpha
  {\left(cj - \frac{m_{01}}{m_{00}}\right)}^\beta f_{ij}
  \label{eq: central moment definition}\\
  \rho & = \sum_{i,j \in \{-1,0,1\}} f_{ij} = m_{00}
  \label{eq: density definition}\\
  u_x  & = \frac{1}{\rho} \sum_{i,j \in \{-1,0,1\}} ic f_{ij} = \frac{m_{10}}{m_{00}}
  \label{eq: x velocity definition}\\
  u_y  & = \frac{1}{\rho} \sum_{i,j \in \{-1,0,1\}} jc f_{ij} = \frac{m_{01}}{m_{00}}.
  \label{eq: y velocity definition}
\end{align}
When looking at pressure, e.g.\ the momentum of the fluid particles normal to an imaginary wall, the discrete case looks quite different.
\begin{figure}
\centering
\input{tikz/billard.tex}
\caption{Path of two particles during a given time, where the brightness depicts the temporal progress. In the time before the collision, the plate $A$ does not experience any pressure, but afterwards the right particle collides with $A$, applying the force $F$, and thus a pressure, to it.}
\label{fig: billard table}
\end{figure}
Here we cannot assume collision invariance, as Figure~\ref{fig: billard table} illustrates.
Hence we can assume the discrete analogon only when the distributions are equal to the equilibrium distributions $f_{ij}^{eq}$ which are by definition collision invariant.
This leaves us with
\begin{equation}
  \begin{aligned}
    \tensor{P}_{xx}
    & = \sum_{ij} {(ic - u_x)}^2 f_{ij}^{eq}
    \\ & =
    \sum_{ij} (i^2c^2 - 2 ic u_x + u_x^2) f_{ij}^{eq}
    \\ & =
    \sum_{ij} i^2 c^2 f_{ij}^{eq} - 2 u_x \sum_{ij} ic f_{ij}^{eq} + u_x^2 \sum_{ij}f_{ij}^{eq}
    \\ & = m_{20}^{eq} - \frac{m_{10}^2}{m_{00}}
  \end{aligned}
\end{equation}
and thus the pressure\footnote{It can be shown, that the pressure is equal to one third the trace of the pressure tensor and that its diagonal elements are equal. The third entry $\tensor{P}_{zz}$ would be the pressure in $z$-direction, which has to be accounted for as 2D simulations are just 3D where we assume the flow to be invariant in one direction. As pressure is isotropic, the pressure is also extended in the last direction, even when the flow velocity is not. When defining this tensor, the $z$-components were left out to not provoke confusion.}\todo[inline]{refer to discussion section}
\begin{equation}
  \label{eq: pressure}
  \begin{aligned}
    p &= \tensor{P}_{xx} = m_{20}^{eq} - \frac{m_{10}^2}{m_{00}}\\
     &= \tensor{P}_{yy} = m_{02}^{eq} - \frac{m_{01}^2}{m_{00}}.
  \end{aligned}
\end{equation}

If we wanted to include equations for energy and thus heat into our analysis, we would need higher order moments like $m_{30}$.
But as we are working with the nine speed model D2Q9 as depicted in Figure~\ref{fig: D2Q9 stencil}, we can only host nine independent moments.
This is easily seen with
\begin{equation}
  m_{30} = \sum_{i,j \in \{-1,0,1\}} i^3 c^3 f_{ij} = c^2\sum_{i,j \in \{-1,0,1\}} ic i^2 f_{ij} = c^2 \sum_{i,j \in \{-1,0,1\}} ic f_{ij} = c^2 m_{10},
\end{equation}
or in general
\begin{equation}
  \label{eq:aliasing of moments 1}
  m_{\alpha\beta}
  = \sum_{i,j \in \{-1,0,1\}} c^{\alpha+\beta} i^\alpha j^\beta f_{ij}
  = \sum_{i,j \in \{-1,0,1\}} c^{\alpha+\beta}i^{(\alpha+2k)} j^\beta f_{ij}
  = c^{-2k} m_{(\alpha+2k)\beta} \quad \forall k,\beta, \forall \alpha \neq 0
\end{equation}
and
\begin{equation}
  \label{eq:aliasing of moments 2}
  m_{\alpha\beta}
  = \sum_{i,j \in \{-1,0,1\}} c^{\alpha+\beta} i^\alpha j^\beta f_{ij}
  = \sum_{i,j \in \{-1,0,1\}} c^{\alpha+\beta}i^\alpha j^{(\beta+2l)} f_{ij}
  = c^{-2l}m_{\alpha(\beta+2l)} \quad \forall l, \alpha, \forall \beta \neq 0.
\end{equation}
The full list of moments in D2Q9 is displayed in Table~\ref{table:D2Q9 moments}, according to~\eqref{eq:aliasing of moments 1} and~\eqref{eq:aliasing of moments 2}.
Another convention we introduce in this section is, that all sums over $i$ and/or $j$ shall range over the discrete velocity space, i.e.
\begin{equation*}
  \sum_{i,j \in \{-1,0,1\}} \rightarrow \sum_{i,j}
\end{equation*}

\setlength{\tabcolsep}{2.9pt}
\begin{table} [t]
  \centering
  \begin{tabular}{r rr rrr rr r rrrrr r}
    \toprule
    \multicolumn{9}{c}{independent moments} & \multicolumn{6}{c}{dependent moments}   \\
    \cmidrule(lr){1-9}\cmidrule(lr){10-15} \\
    $m_{00}$
    & $m_{10}$
    & $m_{01}$
    & $m_{11}$
    & $m_{20}$
    & $m_{02}$
    & $m_{21}$
    & $m_{12}$
    & $m_{22}$
    & $c^{-1}m_{30}$
    & $c^{-1}m_{03}$
    & $c^{-1}m_{31}$
    & $c^{-1}m_{13}$
    & $c^{-1}m_{40}$
    & \ldots \\
    &&&&&&&&
    & = $m_{10}$
    & = $m_{01}$
    & = $m_{11}$
    & = $m_{11}$
    & = $m_{20}$ & \\
    \bottomrule
  \end{tabular}
  \caption{D2Q9 moments}\label{table:D2Q9 moments}
\end{table}
